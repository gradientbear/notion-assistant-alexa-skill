(()=>{var e={};e.id=461,e.ids=[461],e.modules={2934:e=>{"use strict";e.exports=require("next/dist/client/components/action-async-storage.external.js")},4580:e=>{"use strict";e.exports=require("next/dist/client/components/request-async-storage.external.js")},5869:e=>{"use strict";e.exports=require("next/dist/client/components/static-generation-async-storage.external.js")},399:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},7302:(e,t,s)=>{"use strict";s.r(t),s.d(t,{GlobalError:()=>i.a,__next_app__:()=>m,originalPathname:()=>u,pages:()=>c,routeModule:()=>p,tree:()=>d}),s(6904),s(1163),s(2874);var a=s(7105),n=s(5265),o=s(157),i=s.n(o),r=s(4665),l={};for(let e in r)0>["default","tree","pages","GlobalError","originalPathname","__next_app__","routeModule"].indexOf(e)&&(l[e]=()=>r[e]);s.d(t,l);let d=["",{children:["onboarding",{children:["__PAGE__",{},{page:[()=>Promise.resolve().then(s.bind(s,6904)),"E:\\Work\\alex\\notion-assistant-alexa-skill\\web-login\\app\\onboarding\\page.tsx"]}]},{}]},{layout:[()=>Promise.resolve().then(s.bind(s,1163)),"E:\\Work\\alex\\notion-assistant-alexa-skill\\web-login\\app\\layout.tsx"],"not-found":[()=>Promise.resolve().then(s.t.bind(s,2874,23)),"next/dist/client/components/not-found-error"]}],c=["E:\\Work\\alex\\notion-assistant-alexa-skill\\web-login\\app\\onboarding\\page.tsx"],u="/onboarding/page",m={require:s,loadChunk:()=>Promise.resolve()},p=new a.AppPageRouteModule({definition:{kind:n.x.APP_PAGE,page:"/onboarding/page",pathname:"/onboarding",bundlePath:"",filename:"",appPaths:[]},userland:{loaderTree:d}})},85:(e,t,s)=>{Promise.resolve().then(s.t.bind(s,3817,23)),Promise.resolve().then(s.t.bind(s,9323,23)),Promise.resolve().then(s.t.bind(s,2204,23)),Promise.resolve().then(s.t.bind(s,820,23)),Promise.resolve().then(s.t.bind(s,5915,23)),Promise.resolve().then(s.t.bind(s,1611,23))},7046:()=>{},9434:(e,t,s)=>{Promise.resolve().then(s.bind(s,1104))},1104:(e,t,s)=>{"use strict";s.r(t),s.d(t,{default:()=>l});var a=s(9899),n=s(5507),o=s(6153),i=s(24),r=s(1565);function l(){let e=(0,o.useRouter)(),[t,s]=(0,n.useState)(!0),[l,d]=(0,n.useState)(null),[c,u]=(0,n.useState)("notion"),[m,p]=(0,n.useState)(!1),[h,x]=(0,n.useState)(""),[b,g]=(0,n.useState)(""),y=async()=>{try{let{data:{user:t}}=await i.O.auth.getUser();if(!t){e.push("/?mode=signin");return}let a=await i.O.auth.getSession(),n=a.data.session?.access_token;if(!n){e.push("/?mode=signin");return}try{let e=await fetch("/api/auth/sync-user",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({auth_user_id:t.id,email:t.email||"",provider:t.app_metadata?.provider||"email"})});e.ok||console.warn("Sync user response not OK:",e.status)}catch(e){console.warn("Sync attempt failed (may already exist):",e)}await new Promise(e=>setTimeout(e,500));let o=await fetch("/api/users/me",{method:"GET",headers:{Authorization:`Bearer ${n}`,"Content-Type":"application/json"},cache:"no-store"});if(!o.ok){if(404===o.status){console.log("User not found, attempting final sync..."),await fetch("/api/auth/sync-user",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({auth_user_id:t.id,email:t.email||"",provider:t.app_metadata?.provider||"email"})}),await new Promise(e=>setTimeout(e,1e3));let e=await fetch("/api/users/me",{method:"GET",headers:{Authorization:`Bearer ${n}`,"Content-Type":"application/json"},cache:"no-store"});if(!e.ok){console.error("User still not found after sync. Status:",e.status),x("Unable to load user data. Please try refreshing the page."),s(!1);return}let a=await e.json();d(a),s(!1);return}console.error("Failed to fetch user:",o.status,o.statusText),x(`Failed to load user: ${o.status}`),s(!1);return}let r=await o.json();if(d(r),r.onboarding_complete){e.push("/dashboard");return}r.notion_token?r.amazon_account_id?r.license_key||u("license"):u("amazon"):u("notion"),s(!1)}catch(e){console.error("Error checking user:",e),s(!1)}},f=async()=>{p(!0);try{let e=await fetch("/api/oauth/initiate",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({email:l?.email,auth_user_id:l?.id})}),{authUrl:t}=await e.json();window.location.href=t}catch(e){console.error("Error initiating Notion OAuth:",e),p(!1)}},j=async()=>{p(!0),e.push("/amazon/link")},N=async()=>{p(!0),e.push("/license")},v=async()=>{l?.amazon_account_id?l?.license_key||u("license"):u("amazon")},k=[{id:"notion",title:"Connect Notion (Optional)",description:"Link your Notion workspace and we'll automatically create the required databases. You can skip this and connect later.",completed:!!l?.notion_token&&l?.notion_setup_complete,action:f,skippable:!0},{id:"amazon",title:"Link Amazon Account",description:"Connect your Amazon account to enable the Alexa skill",completed:!!l?.amazon_account_id,action:j},{id:"license",title:"Enter License Key",description:"Provide your license key to activate the skill",completed:!!l?.license_key,action:N}];return t?a.jsx("div",{className:"min-h-screen flex items-center justify-center bg-gradient-to-br from-blue-50 to-indigo-100",children:(0,a.jsxs)("div",{className:"text-gray-600",children:[a.jsx(r.fCD,{className:"animate-spin text-4xl mx-auto mb-4"}),a.jsx("p",{children:"Loading..."})]})}):a.jsx("div",{className:"min-h-screen bg-gradient-to-br from-blue-50 to-indigo-100 py-12 px-4",children:a.jsx("div",{className:"max-w-2xl mx-auto",children:(0,a.jsxs)("div",{className:"bg-white rounded-2xl shadow-xl p-8",children:[a.jsx("h1",{className:"text-3xl font-bold text-gray-900 mb-2",children:"Welcome to Notion Data"}),a.jsx("p",{className:"text-gray-600 mb-8",children:"Complete these steps to get started"}),b&&(0,a.jsxs)("div",{className:"mb-6 p-4 bg-green-50 border border-green-200 text-green-700 rounded-lg",children:[a.jsx("p",{className:"font-medium mb-2",children:"Success!"}),a.jsx("p",{className:"text-sm",children:b})]}),h&&(0,a.jsxs)("div",{className:"mb-6 p-4 bg-red-50 border border-red-200 text-red-700 rounded-lg",children:[a.jsx("p",{className:"font-medium mb-2",children:"Error"}),a.jsx("p",{className:"text-sm mb-3",children:h}),a.jsx("button",{onClick:()=>{x(""),s(!0),y()},className:"px-4 py-2 bg-red-600 text-white rounded-lg hover:bg-red-700 text-sm",children:"Retry"})]}),a.jsx("div",{className:"space-y-6 mb-8",children:k.map((e,t)=>{let s=c===e.id,n=e.completed;return a.jsx("div",{className:`border-2 rounded-lg p-6 transition-all ${s?"border-blue-500 bg-blue-50":n?"border-green-500 bg-green-50":"border-gray-200 bg-gray-50"}`,children:(0,a.jsxs)("div",{className:"flex items-start gap-4",children:[a.jsx("div",{className:"flex-shrink-0 mt-1",children:n?a.jsx(r.FJM,{className:"text-green-500 text-2xl"}):s?a.jsx(r.gbA,{className:"text-blue-500 text-2xl"}):a.jsx(r.gbA,{className:"text-gray-300 text-2xl"})}),(0,a.jsxs)("div",{className:"flex-1",children:[(0,a.jsxs)("h3",{className:"text-xl font-semibold text-gray-900 mb-1",children:[t+1,". ",e.title]}),a.jsx("p",{className:"text-gray-600 mb-4",children:e.description}),s&&!n&&(0,a.jsxs)("div",{className:"flex flex-col sm:flex-row gap-3",children:["notion"===e.id&&(0,a.jsxs)(a.Fragment,{children:[a.jsx("a",{href:"https://www.notion.so/signup",target:"_blank",rel:"noopener noreferrer",className:"px-6 py-2 bg-white border-2 border-blue-600 text-blue-600 font-semibold rounded-lg hover:bg-blue-50 transition text-center",children:"Create Notion Account"}),a.jsx("button",{onClick:e.action,disabled:m,className:"px-6 py-2 bg-gradient-to-r from-blue-600 to-indigo-600 text-white font-semibold rounded-lg hover:from-blue-700 hover:to-indigo-700 transition disabled:opacity-50",children:m?"Processing...":"Connect Notion"}),a.jsx("button",{onClick:v,disabled:m,className:"px-6 py-2 bg-gray-200 text-gray-700 font-semibold rounded-lg hover:bg-gray-300 transition disabled:opacity-50",children:"Skip for Now"})]}),"notion"!==e.id&&a.jsx("button",{onClick:e.action,disabled:m,className:"px-6 py-2 bg-gradient-to-r from-blue-600 to-indigo-600 text-white font-semibold rounded-lg hover:from-blue-700 hover:to-indigo-700 transition disabled:opacity-50",children:m?"Processing...":`Start ${e.title}`})]}),n&&a.jsx("span",{className:"inline-flex items-center px-3 py-1 bg-green-100 text-green-800 rounded-full text-sm font-medium",children:"Completed"})]})]})},e.id)})}),"notion"===c&&(0,a.jsxs)("div",{className:"space-y-4 mb-6",children:[(0,a.jsxs)("div",{className:"bg-blue-50 border border-blue-200 rounded-lg p-4",children:[a.jsx("p",{className:"text-sm text-blue-800 mb-2",children:a.jsx("strong",{children:"Don't have a Notion account?"})}),a.jsx("p",{className:"text-sm text-blue-700 mb-3",children:'Notion is free to use. Click "Create Notion Account" above to sign up, then come back to connect your workspace.'}),a.jsx("p",{className:"text-sm text-blue-700",children:"You can also skip this step and connect Notion later from your dashboard."})]}),(0,a.jsxs)("div",{className:"bg-green-50 border border-green-200 rounded-lg p-4",children:[a.jsx("p",{className:"text-sm text-green-800",children:a.jsx("strong",{children:"What we'll create in your Notion workspace:"})}),(0,a.jsxs)("ul",{className:"list-disc list-inside text-sm text-green-700 mt-2 space-y-1",children:[a.jsx("li",{children:'A "Privacy" page in your Notion workspace'}),a.jsx("li",{children:"Tasks database for task management"}),a.jsx("li",{children:"Focus_Logs database for focus tracking"}),a.jsx("li",{children:"Energy_Logs database for energy tracking"})]})]})]}),"amazon"===c&&(0,a.jsxs)("div",{className:"bg-blue-50 border border-blue-200 rounded-lg p-4 mb-6",children:[a.jsx("p",{className:"text-sm text-blue-800",children:a.jsx("strong",{children:"Why link your Amazon account?"})}),(0,a.jsxs)("ul",{className:"list-disc list-inside text-sm text-blue-700 mt-2 space-y-1",children:[a.jsx("li",{children:"Enables the Alexa skill to identify you"}),a.jsx("li",{children:"Required for using the skill on your Alexa devices"}),a.jsx("li",{children:"Links your web account to your Alexa account"})]})]})]})})})}},24:(e,t,s)=>{"use strict";s.d(t,{O:()=>i});var a=s(9283);let n="https://ptasyynqqlvrbhqmtvhl.supabase.co",o="eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InB0YXN5eW5xcWx2cmJocW10dmhsIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjM4NzYwODYsImV4cCI6MjA3OTQ1MjA4Nn0.di3Mk3cndlDzjWwUoXcB8DDslyJO-lbsIHtwRKaWCZI";if(!n||!o)throw Error("Missing Supabase environment variables. Please set NEXT_PUBLIC_SUPABASE_URL and NEXT_PUBLIC_SUPABASE_ANON_KEY. For local development, create a .env.local file. For production (Vercel), add them in your project settings.");if(n.includes("supabase.com/dashboard")||n.includes("dashboard/project"))throw Error(`❌ Invalid Supabase URL format!
  
Your NEXT_PUBLIC_SUPABASE_URL is set to: ${n}

This looks like a dashboard URL. It should be the API URL instead.

Correct format: https://[project-ref].supabase.co
Example: https://ptasyynqqlvrbhqmtvhl.supabase.co

To fix:
1. Go to Supabase Dashboard → Settings → API
2. Copy the "Project URL" (not the dashboard URL)
3. Update NEXT_PUBLIC_SUPABASE_URL in Vercel
4. Redeploy your application`);let i=(0,a.eI)(n,o)},1163:(e,t,s)=>{"use strict";s.r(t),s.d(t,{default:()=>o,metadata:()=>n});var a=s(5023);s(642);let n={title:"Notion Data - Account Linking",description:"Link your Notion account to Alexa Skill"};function o({children:e}){return a.jsx("html",{lang:"en",suppressHydrationWarning:!0,children:a.jsx("body",{suppressHydrationWarning:!0,children:e})})}},6904:(e,t,s)=>{"use strict";s.r(t),s.d(t,{default:()=>a});let a=(0,s(2772).createProxy)(String.raw`E:\Work\alex\notion-assistant-alexa-skill\web-login\app\onboarding\page.tsx#default`)},642:()=>{}};var t=require("../../webpack-runtime.js");t.C(e);var s=e=>t(t.s=e),a=t.X(0,[942,371,405,565],()=>s(7302));module.exports=a})();