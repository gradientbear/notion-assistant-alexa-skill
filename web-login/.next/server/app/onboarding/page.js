(()=>{var e={};e.id=461,e.ids=[461],e.modules={2934:e=>{"use strict";e.exports=require("next/dist/client/components/action-async-storage.external.js")},4580:e=>{"use strict";e.exports=require("next/dist/client/components/request-async-storage.external.js")},5869:e=>{"use strict";e.exports=require("next/dist/client/components/static-generation-async-storage.external.js")},399:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},7302:(e,t,a)=>{"use strict";a.r(t),a.d(t,{GlobalError:()=>i.a,__next_app__:()=>m,originalPathname:()=>u,pages:()=>c,routeModule:()=>p,tree:()=>d}),a(6904),a(1163),a(2874);var o=a(7105),s=a(5265),n=a(157),i=a.n(n),r=a(4665),l={};for(let e in r)0>["default","tree","pages","GlobalError","originalPathname","__next_app__","routeModule"].indexOf(e)&&(l[e]=()=>r[e]);a.d(t,l);let d=["",{children:["onboarding",{children:["__PAGE__",{},{page:[()=>Promise.resolve().then(a.bind(a,6904)),"E:\\Work\\alex\\notion-assistant-alexa-skill\\web-login\\app\\onboarding\\page.tsx"]}]},{}]},{layout:[()=>Promise.resolve().then(a.bind(a,1163)),"E:\\Work\\alex\\notion-assistant-alexa-skill\\web-login\\app\\layout.tsx"],"not-found":[()=>Promise.resolve().then(a.t.bind(a,2874,23)),"next/dist/client/components/not-found-error"]}],c=["E:\\Work\\alex\\notion-assistant-alexa-skill\\web-login\\app\\onboarding\\page.tsx"],u="/onboarding/page",m={require:a,loadChunk:()=>Promise.resolve()},p=new o.AppPageRouteModule({definition:{kind:s.x.APP_PAGE,page:"/onboarding/page",pathname:"/onboarding",bundlePath:"",filename:"",appPaths:[]},userland:{loaderTree:d}})},85:(e,t,a)=>{Promise.resolve().then(a.t.bind(a,3817,23)),Promise.resolve().then(a.t.bind(a,9323,23)),Promise.resolve().then(a.t.bind(a,2204,23)),Promise.resolve().then(a.t.bind(a,820,23)),Promise.resolve().then(a.t.bind(a,5915,23)),Promise.resolve().then(a.t.bind(a,1611,23))},7046:()=>{},9434:(e,t,a)=>{Promise.resolve().then(a.bind(a,1104))},1104:(e,t,a)=>{"use strict";a.r(t),a.d(t,{default:()=>l});var o=a(9899),s=a(5507),n=a(6153),i=a(24),r=a(1565);function l(){let e=(0,n.useRouter)(),[t,a]=(0,s.useState)(!0),[l,d]=(0,s.useState)(null),[c,u]=(0,s.useState)("notion"),[m,p]=(0,s.useState)(!1),[h,x]=(0,s.useState)(""),[b,g]=(0,s.useState)(""),y=async()=>{try{let{data:{user:t}}=await i.O.auth.getUser();if(!t){e.push("/?mode=signin");return}let o=await i.O.auth.getSession(),s=o.data.session?.access_token;if(!s){e.push("/?mode=signin");return}try{let e=await fetch("/api/auth/sync-user",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({auth_user_id:t.id,email:t.email||"",provider:t.app_metadata?.provider||"email"})});e.ok||console.warn("Sync user response not OK:",e.status)}catch(e){console.warn("Sync attempt failed (may already exist):",e)}await new Promise(e=>setTimeout(e,500));let n=await fetch("/api/users/me",{method:"GET",headers:{Authorization:`Bearer ${s}`,"Content-Type":"application/json"},cache:"no-store"});if(!n.ok){if(404===n.status){console.log("User not found, attempting final sync..."),await fetch("/api/auth/sync-user",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({auth_user_id:t.id,email:t.email||"",provider:t.app_metadata?.provider||"email"})}),await new Promise(e=>setTimeout(e,1e3));let e=await fetch("/api/users/me",{method:"GET",headers:{Authorization:`Bearer ${s}`,"Content-Type":"application/json"},cache:"no-store"});if(!e.ok){console.error("User still not found after sync. Status:",e.status),x("Unable to load user data. Please try refreshing the page."),a(!1);return}let o=await e.json();d(o),a(!1);return}console.error("Failed to fetch user:",n.status,n.statusText),x(`Failed to load user: ${n.status}`),a(!1);return}let r=await n.json();if(d(r),r.onboarding_complete){e.push("/dashboard");return}if(r.notion_token){if(r.amazon_account_id){u("complete");try{let e=await i.O.auth.getSession(),t=e.data.session?.access_token;t&&await fetch("/api/users/complete-onboarding",{method:"POST",headers:{Authorization:`Bearer ${t}`,"Content-Type":"application/json"}})}catch(e){console.warn("Failed to auto-complete onboarding:",e)}}else u("amazon")}else u("notion");a(!1)}catch(e){console.error("Error checking user:",e),a(!1)}},f=async()=>{p(!0);try{let{data:{user:e}}=await i.O.auth.getUser();if(!e){x("Please sign in to connect Notion"),p(!1);return}let t=await fetch("/api/oauth/initiate",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({email:l?.email||e.email,auth_user_id:e.id})});if(!t.ok){let e=await t.json();throw Error(e.error||"Failed to initiate Notion connection")}let{authUrl:a}=await t.json();window.location.href=a}catch(e){console.error("Error initiating Notion OAuth:",e),x(e.message||"Failed to connect Notion. Please try again."),p(!1)}},j=async()=>{p(!0),e.push("/amazon/link")},N=async()=>{l?.amazon_account_id?u("complete"):u("amazon")},v=[{id:"notion",title:"Connect Notion (Optional)",description:"Link your Notion workspace and we'll automatically create the required databases. You can skip this and connect later.",completed:!!l?.notion_token&&l?.notion_setup_complete,action:f,skippable:!0},{id:"amazon",title:"Link Amazon Account",description:"Connect your Amazon account to enable the Alexa skill",completed:!!l?.amazon_account_id,action:j}];return t?o.jsx("div",{className:"min-h-screen flex items-center justify-center bg-gradient-to-br from-blue-50 to-indigo-100",children:(0,o.jsxs)("div",{className:"text-gray-600",children:[o.jsx(r.fCD,{className:"animate-spin text-4xl mx-auto mb-4"}),o.jsx("p",{children:"Loading..."})]})}):o.jsx("div",{className:"min-h-screen bg-gradient-to-br from-blue-50 to-indigo-100 py-12 px-4",children:o.jsx("div",{className:"max-w-2xl mx-auto",children:(0,o.jsxs)("div",{className:"bg-white rounded-2xl shadow-xl p-8",children:[o.jsx("h1",{className:"text-3xl font-bold text-gray-900 mb-2",children:"Welcome to Notion Data"}),o.jsx("p",{className:"text-gray-600 mb-8",children:"Complete these steps to get started"}),b&&(0,o.jsxs)("div",{className:"mb-6 p-4 bg-green-50 border border-green-200 text-green-700 rounded-lg",children:[o.jsx("p",{className:"font-medium mb-2",children:"Success!"}),o.jsx("p",{className:"text-sm",children:b})]}),h&&(0,o.jsxs)("div",{className:"mb-6 p-4 bg-red-50 border border-red-200 text-red-700 rounded-lg",children:[o.jsx("p",{className:"font-medium mb-2",children:"Error"}),o.jsx("p",{className:"text-sm mb-3",children:h}),o.jsx("button",{onClick:()=>{x(""),a(!0),y()},className:"px-4 py-2 bg-red-600 text-white rounded-lg hover:bg-red-700 text-sm",children:"Retry"})]}),o.jsx("div",{className:"space-y-6 mb-8",children:v.map((e,t)=>{let a=c===e.id,s=e.completed;return o.jsx("div",{className:`border-2 rounded-lg p-6 transition-all ${a?"border-blue-500 bg-blue-50":s?"border-green-500 bg-green-50":"border-gray-200 bg-gray-50"}`,children:(0,o.jsxs)("div",{className:"flex items-start gap-4",children:[o.jsx("div",{className:"flex-shrink-0 mt-1",children:s?o.jsx(r.FJM,{className:"text-green-500 text-2xl"}):a?o.jsx(r.gbA,{className:"text-blue-500 text-2xl"}):o.jsx(r.gbA,{className:"text-gray-300 text-2xl"})}),(0,o.jsxs)("div",{className:"flex-1",children:[(0,o.jsxs)("h3",{className:"text-xl font-semibold text-gray-900 mb-1",children:[t+1,". ",e.title]}),o.jsx("p",{className:"text-gray-600 mb-4",children:e.description}),a&&!s&&(0,o.jsxs)("div",{className:"flex flex-col sm:flex-row gap-3",children:["notion"===e.id&&(0,o.jsxs)(o.Fragment,{children:[o.jsx("a",{href:"https://www.notion.so/signup",target:"_blank",rel:"noopener noreferrer",className:"px-6 py-2 bg-white border-2 border-blue-600 text-blue-600 font-semibold rounded-lg hover:bg-blue-50 transition text-center",children:"Create Notion Account"}),o.jsx("button",{onClick:e.action,disabled:m,className:"px-6 py-2 bg-gradient-to-r from-blue-600 to-indigo-600 text-white font-semibold rounded-lg hover:from-blue-700 hover:to-indigo-700 transition disabled:opacity-50",children:m?"Processing...":"Connect Notion"}),o.jsx("button",{onClick:N,disabled:m,className:"px-6 py-2 bg-gray-200 text-gray-700 font-semibold rounded-lg hover:bg-gray-300 transition disabled:opacity-50",children:"Skip for Now"})]}),"notion"!==e.id&&o.jsx("button",{onClick:e.action,disabled:m,className:"px-6 py-2 bg-gradient-to-r from-blue-600 to-indigo-600 text-white font-semibold rounded-lg hover:from-blue-700 hover:to-indigo-700 transition disabled:opacity-50",children:m?"Processing...":`Start ${e.title}`})]}),s&&o.jsx("span",{className:"inline-flex items-center px-3 py-1 bg-green-100 text-green-800 rounded-full text-sm font-medium",children:"Completed"})]})]})},e.id)})}),"notion"===c&&(0,o.jsxs)("div",{className:"space-y-4 mb-6",children:[(0,o.jsxs)("div",{className:"bg-blue-50 border border-blue-200 rounded-lg p-4",children:[o.jsx("p",{className:"text-sm text-blue-800 mb-2",children:o.jsx("strong",{children:"Don't have a Notion account?"})}),o.jsx("p",{className:"text-sm text-blue-700 mb-3",children:'Notion is free to use. Click "Create Notion Account" above to sign up, then come back to connect your workspace.'}),o.jsx("p",{className:"text-sm text-blue-700",children:"You can also skip this step and connect Notion later from your dashboard."})]}),(0,o.jsxs)("div",{className:"bg-green-50 border border-green-200 rounded-lg p-4",children:[o.jsx("p",{className:"text-sm text-green-800",children:o.jsx("strong",{children:"What we'll create in your Notion workspace:"})}),(0,o.jsxs)("ul",{className:"list-disc list-inside text-sm text-green-700 mt-2 space-y-1",children:[o.jsx("li",{children:'A "Notion Data" page in your Notion workspace'}),o.jsx("li",{children:"Tasks database for task management"}),o.jsx("li",{children:"Focus_Logs database for focus tracking"}),o.jsx("li",{children:"Energy_Logs database for energy tracking"})]})]})]}),"amazon"===c&&(0,o.jsxs)("div",{className:"bg-blue-50 border border-blue-200 rounded-lg p-4 mb-6",children:[o.jsx("p",{className:"text-sm text-blue-800",children:o.jsx("strong",{children:"Why link your Amazon account?"})}),(0,o.jsxs)("ul",{className:"list-disc list-inside text-sm text-blue-700 mt-2 space-y-1",children:[o.jsx("li",{children:"Enables the Alexa skill to identify you"}),o.jsx("li",{children:"Required for using the skill on your Alexa devices"}),o.jsx("li",{children:"Links your web account to your Alexa account"})]})]})]})})})}},24:(e,t,a)=>{"use strict";a.d(t,{O:()=>i});var o=a(9283);let s="https://ptasyynqqlvrbhqmtvhl.supabase.co",n="eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InB0YXN5eW5xcWx2cmJocW10dmhsIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjM4NzYwODYsImV4cCI6MjA3OTQ1MjA4Nn0.di3Mk3cndlDzjWwUoXcB8DDslyJO-lbsIHtwRKaWCZI";if(!s||!n)throw Error("Missing Supabase environment variables. Please set NEXT_PUBLIC_SUPABASE_URL and NEXT_PUBLIC_SUPABASE_ANON_KEY. For local development, create a .env.local file. For production (Vercel), add them in your project settings.");if(s.includes("supabase.com/dashboard")||s.includes("dashboard/project"))throw Error(`❌ Invalid Supabase URL format!
  
Your NEXT_PUBLIC_SUPABASE_URL is set to: ${s}

This looks like a dashboard URL. It should be the API URL instead.

Correct format: https://[project-ref].supabase.co
Example: https://ptasyynqqlvrbhqmtvhl.supabase.co

To fix:
1. Go to Supabase Dashboard → Settings → API
2. Copy the "Project URL" (not the dashboard URL)
3. Update NEXT_PUBLIC_SUPABASE_URL in Vercel
4. Redeploy your application`);let i=(0,o.createClient)(s,n)},1163:(e,t,a)=>{"use strict";a.r(t),a.d(t,{default:()=>n,metadata:()=>s});var o=a(5023);a(642);let s={title:"Notion Data - Account Linking",description:"Link your Notion account to Alexa Skill"};function n({children:e}){return o.jsx("html",{lang:"en",suppressHydrationWarning:!0,children:o.jsx("body",{suppressHydrationWarning:!0,children:e})})}},6904:(e,t,a)=>{"use strict";a.r(t),a.d(t,{default:()=>o});let o=(0,a(2772).createProxy)(String.raw`E:\Work\alex\notion-assistant-alexa-skill\web-login\app\onboarding\page.tsx#default`)},642:()=>{}};var t=require("../../webpack-runtime.js");t.C(e);var a=e=>t(t.s=e),o=t.X(0,[942,371,405,565],()=>a(7302));module.exports=o})();