"use strict";(()=>{var e={};e.id=262,e.ids=[262],e.modules={399:e=>{e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},6329:(e,r,t)=>{t.r(r),t.d(r,{originalPathname:()=>g,patchFetch:()=>R,requestAsyncStorage:()=>d,routeModule:()=>l,serverHooks:()=>m,staticGenerationAsyncStorage:()=>h});var o={};t.r(o),t.d(o,{GET:()=>p,dynamic:()=>u});var n=t(3277),a=t(5265),s=t(5356),i=t(7076),c=t(2851);let u="force-dynamic";async function p(e){try{let r="https://ptasyynqqlvrbhqmtvhl.supabase.co",t=process.env.SUPABASE_SERVICE_KEY||"",o=process.env.NOTION_CLIENT_ID||"",n=process.env.NOTION_CLIENT_SECRET||"",a=process.env.NOTION_REDIRECT_URI||"";if(!r||!t)return i.NextResponse.redirect(new URL("/error?message=Missing Supabase environment variables",e.url));if(!o||!n||!a)return i.NextResponse.redirect(new URL("/error?message=Missing Notion OAuth configuration",e.url));(0,c.eI)(r,t);let s=e.nextUrl.searchParams,u=s.get("code"),p=s.get("state"),l=s.get("error");if(l)return i.NextResponse.redirect(new URL(`/error?message=${encodeURIComponent(l)}`,e.url));if(!u||!p)return i.NextResponse.redirect(new URL("/error?message=Missing authorization code",e.url));let d=await fetch("https://api.notion.com/v1/oauth/token",{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Basic ${Buffer.from(`${o}:${n}`).toString("base64")}`},body:JSON.stringify({grant_type:"authorization_code",code:u,redirect_uri:a})});if(!d.ok){let r=await d.json();return console.error("Token exchange error:",r),i.NextResponse.redirect(new URL(`/error?message=${encodeURIComponent("Failed to exchange token")}`,e.url))}let{access_token:h}=await d.json();return i.NextResponse.redirect(new URL(`/success?token=${encodeURIComponent(h)}`,e.url))}catch(r){return console.error("OAuth callback error:",r),i.NextResponse.redirect(new URL(`/error?message=${encodeURIComponent("OAuth callback failed")}`,e.url))}}let l=new n.AppRouteRouteModule({definition:{kind:a.x.APP_ROUTE,page:"/api/oauth/callback/route",pathname:"/api/oauth/callback",filename:"route",bundlePath:"app/api/oauth/callback/route"},resolvedPagePath:"E:\\Work\\alex\\notion-assistant-alexa-skill\\web-login\\app\\api\\oauth\\callback\\route.ts",nextConfigOutput:"",userland:o}),{requestAsyncStorage:d,staticGenerationAsyncStorage:h,serverHooks:m}=l,g="/api/oauth/callback/route";function R(){return(0,s.patchFetch)({serverHooks:m,staticGenerationAsyncStorage:h})}}};var r=require("../../../../webpack-runtime.js");r.C(e);var t=e=>r(r.s=e),o=r.X(0,[942,837],()=>t(6329));module.exports=o})();