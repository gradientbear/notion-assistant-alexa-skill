(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[41],{2962:function(e,t,n){Promise.resolve().then(n.bind(n,4582))},4582:function(e,t,n){"use strict";n.r(t),n.d(t,{default:function(){return l}});var o=n(7821),a=n(8078),i=n(8504),r=n(9905);function s(){let e=(0,i.useRouter)(),t=(0,i.useSearchParams)(),[n,s]=(0,a.useState)(!0),[l,c]=(0,a.useState)(!1),[u,d]=(0,a.useState)(null),[h,m]=(0,a.useState)(null);(0,a.useEffect)(()=>{p();let e=t.get("amazon_account_id");e&&(m(e),b(e))},[t]);let p=async()=>{try{var t;let{data:{user:n}}=await r.O.auth.getUser();if(!n){e.push("/?mode=signin");return}let o=await fetch("/api/users/me",{headers:{Authorization:"Bearer ".concat(null===(t=(await r.O.auth.getSession()).data.session)||void 0===t?void 0:t.access_token)}});if(!o.ok)throw Error("Failed to fetch user");let a=await o.json();if(d(a),a.amazon_account_id){e.push("/onboarding");return}s(!1)}catch(t){console.error("Error checking user:",t),e.push("/?mode=signin")}},b=async t=>{c(!0);try{var n,o;let a=t||h;if(!a){let t=prompt("Enter your Amazon Account ID (for testing) or leave empty to skip:");if(!t||""===t.trim()){c(!1);return}let n=await r.O.auth.getSession(),a=null===(o=n.data.session)||void 0===o?void 0:o.access_token;if(!(await fetch("/api/users/link-amazon",{method:"POST",headers:{"Content-Type":"application/json",Authorization:"Bearer ".concat(a)},body:JSON.stringify({amazon_account_id:t.trim()})})).ok)throw Error("Failed to link Amazon account");e.push("/onboarding");return}let i=await r.O.auth.getSession(),s=null===(n=i.data.session)||void 0===n?void 0:n.access_token;if(!(await fetch("/api/users/link-amazon",{method:"POST",headers:{"Content-Type":"application/json",Authorization:"Bearer ".concat(s)},body:JSON.stringify({amazon_account_id:a})})).ok)throw Error("Failed to link Amazon account");e.push("/onboarding")}catch(e){console.error("Error linking Amazon account:",e),alert("Failed to link Amazon account. Please try again."),c(!1)}};return n?(0,o.jsx)("div",{className:"min-h-screen flex items-center justify-center bg-gradient-to-br from-blue-50 to-indigo-100",children:(0,o.jsx)("div",{className:"text-gray-600",children:"Loading..."})}):(0,o.jsx)("div",{className:"min-h-screen flex items-center justify-center bg-gradient-to-br from-blue-50 to-indigo-100 px-4",children:(0,o.jsxs)("div",{className:"w-full max-w-md bg-white rounded-2xl shadow-xl p-8",children:[(0,o.jsx)("h1",{className:"text-2xl font-bold text-gray-900 mb-4",children:"Link Amazon Account"}),(0,o.jsx)("p",{className:"text-gray-600 mb-6",children:"To use the Alexa skill, you need to link your Amazon account. This allows the skill to identify you."}),(0,o.jsxs)("div",{className:"bg-blue-50 border border-blue-200 rounded-lg p-4 mb-6",children:[(0,o.jsx)("p",{className:"text-sm text-blue-800 font-medium mb-2",children:"How to link:"}),(0,o.jsxs)("ol",{className:"list-decimal list-inside text-sm text-blue-700 space-y-1",children:[(0,o.jsx)("li",{children:"Open the Alexa app on your phone"}),(0,o.jsx)("li",{children:'Search for "Voice Planner" skill'}),(0,o.jsx)("li",{children:'Click "Enable" or "Link Account"'}),(0,o.jsx)("li",{children:"You'll be redirected back here automatically"})]})]}),(0,o.jsx)("button",{onClick:()=>b(),disabled:l,className:"w-full py-3 bg-gradient-to-r from-blue-600 to-indigo-600 text-white font-semibold rounded-lg hover:from-blue-700 hover:to-indigo-700 transition disabled:opacity-50",children:l?"Linking...":"Link Amazon Account (Test Mode)"}),(0,o.jsxs)("p",{className:"text-xs text-gray-500 mt-2 text-center",children:["For testing: Click the button above and enter your Amazon Account ID when prompted.",(0,o.jsx)("br",{}),"You can get this from the Alexa Developer Console Simulator."]}),(0,o.jsx)("button",{onClick:()=>e.push("/onboarding"),className:"w-full mt-3 py-2 text-gray-600 hover:text-gray-800 font-medium",children:"Skip for now"})]})})}function l(){return(0,o.jsx)(a.Suspense,{fallback:(0,o.jsx)("div",{className:"min-h-screen flex items-center justify-center bg-gradient-to-br from-blue-50 to-indigo-100",children:(0,o.jsx)("div",{className:"text-gray-600",children:"Loading..."})}),children:(0,o.jsx)(s,{})})}},9905:function(e,t,n){"use strict";n.d(t,{O:function(){return r}});var o=n(2616);n(2949);let a="https://mwvurelnhrcbtpjtsiyb.supabase.co",i="eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Im13dnVyZWxuaHJjYnRwanRzaXliIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjQ2MTE2NjYsImV4cCI6MjA4MDE4NzY2Nn0.4kMmjVKg9V0qUhQQMzxu9CdJuQ-zWpItaaqT3QzAEII";if(!a||!i)throw console.error("❌ Missing Supabase configuration!"),console.error("Please set NEXT_PUBLIC_SUPABASE_URL and NEXT_PUBLIC_SUPABASE_ANON_KEY in your environment variables."),Error("Missing Supabase environment variables. Please set NEXT_PUBLIC_SUPABASE_URL and NEXT_PUBLIC_SUPABASE_ANON_KEY. For local development, create a .env.local file. For production (Vercel), add them in your project settings.");if(a.includes("supabase.com/dashboard")||a.includes("dashboard/project")){let e="❌ Invalid Supabase URL format!\n  \nYour NEXT_PUBLIC_SUPABASE_URL is set to: ".concat(a,'\n\nThis looks like a dashboard URL. It should be the API URL instead.\n\nCorrect format: https://[project-ref].supabase.co\nExample: https://ptasyynqqlvrbhqmtvhl.supabase.co\n\nTo fix:\n1. Go to Supabase Dashboard → Settings → API\n2. Copy the "Project URL" (not the dashboard URL)\n3. Update NEXT_PUBLIC_SUPABASE_URL in Vercel\n4. Redeploy your application');throw console.error(e),alert("Configuration Error: Supabase URL is incorrect. Check console for details."),Error(e)}let r=(0,o.createClient)(a,i)}},function(e){e.O(0,[479,115,364,744],function(){return e(e.s=2962)}),_N_E=e.O()}]);