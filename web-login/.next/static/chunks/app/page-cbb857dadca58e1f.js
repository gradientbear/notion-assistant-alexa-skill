(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[931],{4552:function(e,t,r){Promise.resolve().then(r.bind(r,1373))},59:function(e,t,r){"use strict";r.d(t,{w_:function(){return l}});var a=r(8078),s={color:void 0,size:void 0,className:void 0,style:void 0,attr:void 0},o=a.createContext&&a.createContext(s),n=function(){return(n=Object.assign||function(e){for(var t,r=1,a=arguments.length;r<a;r++)for(var s in t=arguments[r])Object.prototype.hasOwnProperty.call(t,s)&&(e[s]=t[s]);return e}).apply(this,arguments)},i=function(e,t){var r={};for(var a in e)Object.prototype.hasOwnProperty.call(e,a)&&0>t.indexOf(a)&&(r[a]=e[a]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols)for(var s=0,a=Object.getOwnPropertySymbols(e);s<a.length;s++)0>t.indexOf(a[s])&&Object.prototype.propertyIsEnumerable.call(e,a[s])&&(r[a[s]]=e[a[s]]);return r};function l(e){return function(t){return a.createElement(c,n({attr:n({},e.attr)},t),function e(t){return t&&t.map(function(t,r){return a.createElement(t.tag,n({key:r},t.attr),e(t.child))})}(e.child))}}function c(e){var t=function(t){var r,s=e.attr,o=e.size,l=e.title,c=i(e,["attr","size","title"]),d=o||t.size||"1em";return t.className&&(r=t.className),e.className&&(r=(r?r+" ":"")+e.className),a.createElement("svg",n({stroke:"currentColor",fill:"currentColor",strokeWidth:"0"},t.attr,s,c,{className:r,style:n(n({color:e.color||t.color},t.style),e.style),height:d,width:d,xmlns:"http://www.w3.org/2000/svg"}),l&&a.createElement("title",null,l),e.children)};return void 0!==o?a.createElement(o.Consumer,null,function(e){return t(e)}):t(s)}},9471:function(e,t,r){"use strict";r.d(t,{z:function(){return s}});var a=r(7821);function s(e){let{variant:t="primary",size:r="md",isLoading:s=!1,children:o,className:n="",disabled:i,...l}=e;return(0,a.jsx)("button",{className:"".concat("font-medium rounded-lg transition-colors focus:outline-none focus:ring-2 focus:ring-offset-2 disabled:opacity-50 disabled:cursor-not-allowed"," ").concat({primary:"bg-blue-600 text-white hover:bg-blue-700 focus:ring-blue-500",secondary:"bg-gray-600 text-white hover:bg-gray-700 focus:ring-gray-500",outline:"border-2 border-gray-300 text-gray-700 hover:bg-gray-50 focus:ring-gray-500",ghost:"text-gray-700 hover:bg-gray-100 focus:ring-gray-500"}[t]," ").concat({sm:"px-3 py-1.5 text-sm",md:"px-4 py-2 text-base",lg:"px-6 py-3 text-lg"}[r]," ").concat(n),disabled:i||s,...l,children:s?(0,a.jsxs)("span",{className:"flex items-center gap-2",children:[(0,a.jsxs)("svg",{className:"animate-spin h-4 w-4",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",children:[(0,a.jsx)("circle",{className:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor",strokeWidth:"4"}),(0,a.jsx)("path",{className:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})]}),"Loading..."]}):o})}r(8078)},9585:function(e,t,r){"use strict";r.d(t,{Z:function(){return s}});var a=r(7821);function s(e){let{children:t,className:r=""}=e;return(0,a.jsx)("div",{className:"bg-white rounded-lg shadow-sm border border-gray-200 p-6 ".concat(r),children:t})}r(8078)},9844:function(e,t,r){"use strict";r.d(t,{h:function(){return l}});var a=r(7821),s=r(8078),o=r(4542),n=r(8504),i=r(9905);function l(e){let{showAuth:t=!0}=e,r=(0,n.useRouter)(),[l,c]=(0,s.useState)(!1);(0,s.useEffect)(()=>{t&&d()},[t]);let d=async()=>{let{data:{session:e}}=await i.O.auth.getSession();c(!!e)},u=async()=>{await i.O.auth.signOut(),r.push("/")};return(0,a.jsx)("header",{className:"border-b border-gray-200 bg-white",children:(0,a.jsx)("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8",children:(0,a.jsxs)("div",{className:"flex justify-between items-center h-16",children:[(0,a.jsx)(o.default,{href:"/",className:"text-xl font-bold text-gray-900",children:"Voice Planner"}),t&&l&&(0,a.jsxs)("div",{className:"flex items-center gap-4",children:[(0,a.jsx)(o.default,{href:"/dashboard",className:"text-gray-600 hover:text-gray-900 font-medium",children:"Dashboard"}),(0,a.jsx)("button",{onClick:u,className:"text-gray-600 hover:text-gray-900 font-medium",children:"Logout"})]})]})})})}},1373:function(e,t,r){"use strict";r.r(t),r.d(t,{default:function(){return g}});var a=r(7821),s=r(8078),o=r(8504),n=r(9905),i=r(9844),l=r(8955);function c(e){let{onGoogleClick:t,onMicrosoftClick:r,onAppleClick:s,isLoading:o=!1}=e;return(0,a.jsxs)("div",{className:"space-y-3",children:[(0,a.jsxs)("button",{onClick:t,disabled:o,className:"w-full flex items-center justify-center gap-3 px-4 py-3 bg-white border-2 border-gray-300 rounded-lg font-medium text-gray-700 hover:bg-gray-50 hover:border-gray-400 transition-colors disabled:opacity-50 disabled:cursor-not-allowed",children:[(0,a.jsx)(l.ldW,{className:"text-red-500 text-xl"}),"Continue with Google"]}),(0,a.jsxs)("button",{onClick:r,disabled:o,className:"w-full flex items-center justify-center gap-3 px-4 py-3 bg-white border-2 border-gray-300 rounded-lg font-medium text-gray-700 hover:bg-gray-50 hover:border-gray-400 transition-colors disabled:opacity-50 disabled:cursor-not-allowed",children:[(0,a.jsx)(l.oV6,{className:"text-blue-500 text-xl"}),"Continue with Microsoft"]}),(0,a.jsxs)("button",{onClick:s,disabled:o,className:"w-full flex items-center justify-center gap-3 px-4 py-3 bg-white border-2 border-gray-300 rounded-lg font-medium text-gray-700 hover:bg-gray-50 hover:border-gray-400 transition-colors disabled:opacity-50 disabled:cursor-not-allowed",children:[(0,a.jsx)(l.oPZ,{className:"text-gray-900 text-xl"}),"Continue with Apple"]})]})}var d=r(9471),u=r(9585);function h(){let e=(0,o.useRouter)(),t=(0,o.useSearchParams)(),[r,l]=(0,s.useState)("login"),[h,g]=(0,s.useState)(""),[m,b]=(0,s.useState)(""),[f,p]=(0,s.useState)(""),[x,y]=(0,s.useState)(!1),[w,v]=(0,s.useState)(""),[j,N]=(0,s.useState)(""),[P,k]=(0,s.useState)(!0);(0,s.useRef)(!1),(0,s.useEffect)(()=>{"signup"===t.get("tab")&&l("signup")},[t]),(0,s.useEffect)(()=>{A();let e=setTimeout(()=>{P&&(console.warn("[AuthPage] Session check timeout, showing auth form"),k(!1))},5e3);return()=>clearTimeout(e)},[]);let A=async()=>{try{console.log("[AuthPage] Checking session...");let{data:{session:r},error:a}=await n.O.auth.getSession();if(!r||a){console.log("[AuthPage] No session found, showing auth form"),k(!1);return}if(r.expires_at&&r.expires_at<Date.now()/1e3){console.log("[AuthPage] Session expired, clearing"),await n.O.auth.signOut(),k(!1);return}let{data:{user:s},error:o}=await n.O.auth.getUser();if(o||!s){console.log("[AuthPage] No valid user found, clearing session. Error:",null==o?void 0:o.message),await n.O.auth.signOut(),k(!1);return}if(!s.email){console.log("[AuthPage] User has no email, clearing session"),await n.O.auth.signOut(),k(!1);return}console.log("[AuthPage] Valid session found for user:",s.email,"- checking redirect");let i=t.get("redirect");if(console.log("[AuthPage] Redirect check:",{hasRedirect:!!i,redirectUrl:i,currentPath:window.location.pathname,currentHref:window.location.href,isApiEndpoint:null==i?void 0:i.includes("/api/")}),i){let t=i.includes("/api/"),r=i===window.location.href,a=new URL(i,window.location.origin).pathname===window.location.pathname&&"/"!==window.location.pathname,s=new URL(i,window.location.origin),o=s.pathname===window.location.pathname||s.searchParams.get("redirect")===window.location.href,l=i.includes("/api/oauth/authorize");if(console.log("[AuthPage] OAuth authorize check:",{isOAuthAuthorize:l,isApiEndpoint:t,isSameUrl:r,wouldRedirectToLogin:o,redirectUrl:i}),l&&t&&!r&&!o){console.log("[AuthPage] Processing OAuth authorize redirect...");let{data:{session:t}}=await n.O.auth.getSession();if(console.log("[AuthPage] Session check:",{hasSession:!!t,hasAccessToken:!!(null==t?void 0:t.access_token)}),null==t?void 0:t.access_token){let e=new URL(i);e.searchParams.set("_session_token",t.access_token),console.log("[AuthPage] Redirecting to OAuth authorize with session token:",{redirectUrl:e.toString(),tokenLength:t.access_token.length});let r="redirect_attempted_".concat(i);sessionStorage.removeItem(r),console.log("[AuthPage] Cleared sessionStorage flag:",r),window.location.href=e.toString();return}console.log("[AuthPage] No session token available, cannot redirect to OAuth authorize"),e.push("/dashboard");return}if(!t||r||o)r||a||o?(console.log("[AuthPage] Redirecting to dashboard (loop prevention or invalid redirect)",{isSameUrl:r,isSamePath:a,wouldRedirectToLogin:o}),e.push("/dashboard")):(console.log("[AuthPage] Redirecting to:",i),e.push(i));else{let t="redirect_attempted_".concat(i);if(sessionStorage.getItem(t)){console.log("[AuthPage] Redirect already attempted, going to dashboard to prevent loop"),sessionStorage.removeItem(t),e.push("/dashboard");return}sessionStorage.setItem(t,"true"),console.log("[AuthPage] Redirecting to API endpoint (full page reload):",i),window.location.href=i;return}}else console.log("[AuthPage] Redirecting to dashboard (no redirect parameter)"),e.push("/dashboard")}catch(e){console.error("[AuthPage] Error checking session:",e);try{await n.O.auth.signOut()}catch(e){console.error("[AuthPage] Error signing out:",e)}k(!1)}},S=e=>/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(e),C=e=>/^(?=.*[a-z])(?=.*[A-Z])(?=.*\d).{8,}$/.test(e),E=async r=>{r.preventDefault(),v(""),y(!0);try{if(!S(h))throw Error("Please enter a valid email address");let{data:r,error:a}=await n.O.auth.signInWithPassword({email:h,password:m});if(a)throw a;if(r.user){if(!r.user.email_confirmed_at)throw Error("Please verify your email before signing in. Check your inbox.");await I(r.user.id,h,"email");let a=t.get("redirect");a?e.push(a):e.push("/dashboard")}}catch(e){v(e.message||"An error occurred")}finally{y(!1)}},O=async e=>{e.preventDefault(),v(""),N(""),y(!0);try{if(!S(h))throw Error("Please enter a valid email address");if(!C(m))throw Error("Password must be at least 8 characters with uppercase, lowercase, and number");if(m!==f)throw Error("Passwords do not match");let{data:e,error:t}=await n.O.auth.signUp({email:h,password:m,options:{emailRedirectTo:"".concat(window.location.origin,"/auth/callback")}});if(t)throw t;if(e.user){try{await I(e.user.id,h,"email"),N("Check your email to verify your account!")}catch(e){console.error("[Signup] Error syncing user:",e),N("Check your email to verify your account! Your account will be fully activated after verification.")}setTimeout(()=>{l("login"),g(""),b(""),p("")},3e3)}}catch(e){v(e.message||"An error occurred")}finally{y(!1)}},_=async e=>{y(!0),v("");try{let{data:t,error:r}=await n.O.auth.signInWithOAuth({provider:e,options:{redirectTo:"".concat(window.location.origin,"/auth/callback")}});if(r)throw r}catch(e){v(e.message||"OAuth sign-in failed"),y(!1)}},U=async e=>{e.preventDefault(),v(""),N(""),y(!0);try{if(!S(h))throw Error("Please enter a valid email address");let{error:e}=await n.O.auth.signInWithOtp({email:h,options:{emailRedirectTo:"".concat(window.location.origin,"/auth/callback")}});if(e)throw e;N("Check your email for the magic link! Click the link to sign in."),g("")}catch(e){v(e.message||"Failed to send magic link")}finally{y(!1)}},I=async(e,t,r)=>{try{console.log("[syncUserToDatabase] Syncing user:",{authUserId:e,email:t,provider:r});let a=await fetch("/api/auth/sync-user",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({auth_user_id:e,email:t,provider:r})});if(!a.ok){let e=await a.json().catch(()=>({error:"Unknown error"}));throw console.error("[syncUserToDatabase] Failed to sync user to database:",e),Error(e.error||"Failed to sync user")}let s=await a.json();return console.log("[syncUserToDatabase] User synced successfully:",s),s}catch(e){throw console.error("[syncUserToDatabase] Error syncing user:",e),e}};return P?(0,a.jsxs)("div",{className:"min-h-screen bg-gray-50",children:[(0,a.jsx)(i.h,{showAuth:!1}),(0,a.jsx)("div",{className:"flex items-center justify-center px-4 py-12",children:(0,a.jsx)("div",{className:"text-gray-600",children:"Loading..."})})]}):(0,a.jsxs)("div",{className:"min-h-screen bg-gray-50",children:[(0,a.jsx)(i.h,{showAuth:!1}),(0,a.jsx)("div",{className:"flex items-center justify-center px-4 py-12",children:(0,a.jsxs)(u.Z,{className:"w-full max-w-md",children:[(0,a.jsxs)("div",{className:"flex border-b border-gray-200 mb-6",children:[(0,a.jsx)("button",{onClick:()=>{l("login"),v(""),N("")},className:"flex-1 py-3 text-center font-medium transition-colors ".concat("login"===r?"text-blue-600 border-b-2 border-blue-600":"text-gray-500 hover:text-gray-700"),children:"Sign In"}),(0,a.jsx)("button",{onClick:()=>{l("signup"),v(""),N("")},className:"flex-1 py-3 text-center font-medium transition-colors ".concat("signup"===r?"text-blue-600 border-b-2 border-blue-600":"text-gray-500 hover:text-gray-700"),children:"Sign Up"})]}),(0,a.jsxs)("div",{className:"text-center mb-8",children:[(0,a.jsx)("h1",{className:"text-3xl font-bold text-gray-900 mb-2",children:"login"===r?"Welcome Back":"Create Account"}),(0,a.jsx)("p",{className:"text-gray-600",children:"login"===r?"Sign in to your Voice Planner account":"Get started with Voice Planner"})]}),w&&(0,a.jsx)("div",{className:"mb-4 p-3 bg-red-50 border border-red-200 text-red-700 rounded-lg text-sm",children:w}),j&&(0,a.jsx)("div",{className:"mb-4 p-3 bg-green-50 border border-green-200 text-green-700 rounded-lg text-sm",children:j}),(0,a.jsx)(c,{onGoogleClick:()=>_("google"),onMicrosoftClick:()=>_("azure"),onAppleClick:()=>_("apple"),isLoading:x}),(0,a.jsxs)("div",{className:"relative my-6",children:[(0,a.jsx)("div",{className:"absolute inset-0 flex items-center",children:(0,a.jsx)("div",{className:"w-full border-t border-gray-300"})}),(0,a.jsx)("div",{className:"relative flex justify-center text-sm",children:(0,a.jsx)("span",{className:"px-2 bg-white text-gray-500",children:"Or continue with email"})})]}),"login"===r?(0,a.jsxs)(a.Fragment,{children:[(0,a.jsxs)("form",{onSubmit:E,className:"space-y-4",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{htmlFor:"email",className:"block text-sm font-medium text-gray-700 mb-1",children:"Email Address"}),(0,a.jsx)("input",{id:"email",type:"email",value:h,onChange:e=>g(e.target.value),required:!0,placeholder:"your@email.com",disabled:x,className:"w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent outline-none transition disabled:bg-gray-100"})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{htmlFor:"password",className:"block text-sm font-medium text-gray-700 mb-1",children:"Password"}),(0,a.jsx)("input",{id:"password",type:"password",value:m,onChange:e=>b(e.target.value),required:!0,placeholder:"Enter your password",disabled:x,className:"w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent outline-none transition disabled:bg-gray-100"})]}),(0,a.jsx)("div",{className:"flex justify-end",children:(0,a.jsx)("a",{href:"/auth/forgot-password",className:"text-sm text-blue-600 hover:text-blue-700 font-medium",children:"Forgot Password?"})}),(0,a.jsx)(d.z,{type:"submit",className:"w-full",isLoading:x,children:"Sign In"})]}),(0,a.jsxs)("div",{className:"relative my-4",children:[(0,a.jsx)("div",{className:"absolute inset-0 flex items-center",children:(0,a.jsx)("div",{className:"w-full border-t border-gray-300"})}),(0,a.jsx)("div",{className:"relative flex justify-center text-sm",children:(0,a.jsx)("span",{className:"px-2 bg-white text-gray-500",children:"Or"})})]}),(0,a.jsxs)("form",{onSubmit:U,className:"space-y-4",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{htmlFor:"magic-email",className:"block text-sm font-medium text-gray-700 mb-1",children:"Sign in with Magic Link (Passwordless)"}),(0,a.jsx)("input",{id:"magic-email",type:"email",value:h,onChange:e=>g(e.target.value),required:!0,placeholder:"your@email.com",disabled:x,className:"w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent outline-none transition disabled:bg-gray-100"}),(0,a.jsx)("p",{className:"mt-1 text-xs text-gray-500",children:"We'll send you a link to sign in without a password"})]}),(0,a.jsx)(d.z,{type:"submit",variant:"outline",className:"w-full",isLoading:x,children:"Send Magic Link"})]})]}):(0,a.jsxs)("form",{onSubmit:O,className:"space-y-4",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{htmlFor:"signup-email",className:"block text-sm font-medium text-gray-700 mb-1",children:"Email Address"}),(0,a.jsx)("input",{id:"signup-email",type:"email",value:h,onChange:e=>g(e.target.value),required:!0,placeholder:"your@email.com",disabled:x,className:"w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent outline-none transition disabled:bg-gray-100"})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{htmlFor:"signup-password",className:"block text-sm font-medium text-gray-700 mb-1",children:"Password"}),(0,a.jsx)("input",{id:"signup-password",type:"password",value:m,onChange:e=>b(e.target.value),required:!0,placeholder:"Min. 8 chars, 1 uppercase, 1 number",disabled:x,className:"w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent outline-none transition disabled:bg-gray-100"})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{htmlFor:"confirmPassword",className:"block text-sm font-medium text-gray-700 mb-1",children:"Confirm Password"}),(0,a.jsx)("input",{id:"confirmPassword",type:"password",value:f,onChange:e=>p(e.target.value),required:!0,placeholder:"Confirm your password",disabled:x,className:"w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent outline-none transition disabled:bg-gray-100"})]}),(0,a.jsx)(d.z,{type:"submit",className:"w-full",isLoading:x,children:"Create Account"})]})]})})]})}function g(){return(0,a.jsx)(s.Suspense,{fallback:(0,a.jsxs)("div",{className:"min-h-screen bg-gray-50",children:[(0,a.jsx)(i.h,{showAuth:!1}),(0,a.jsx)("div",{className:"flex items-center justify-center px-4 py-12",children:(0,a.jsx)("div",{className:"text-gray-600",children:"Loading..."})})]}),children:(0,a.jsx)(h,{})})}},9905:function(e,t,r){"use strict";r.d(t,{O:function(){return n}});var a=r(2616);r(2949);let s="https://mwvurelnhrcbtpjtsiyb.supabase.co",o="eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Im13dnVyZWxuaHJjYnRwanRzaXliIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjQ2MTE2NjYsImV4cCI6MjA4MDE4NzY2Nn0.4kMmjVKg9V0qUhQQMzxu9CdJuQ-zWpItaaqT3QzAEII";if(!s||!o)throw console.error("❌ Missing Supabase configuration!"),console.error("Please set NEXT_PUBLIC_SUPABASE_URL and NEXT_PUBLIC_SUPABASE_ANON_KEY in your environment variables."),Error("Missing Supabase environment variables. Please set NEXT_PUBLIC_SUPABASE_URL and NEXT_PUBLIC_SUPABASE_ANON_KEY. For local development, create a .env.local file. For production (Vercel), add them in your project settings.");if(s.includes("supabase.com/dashboard")||s.includes("dashboard/project")){let e="❌ Invalid Supabase URL format!\n  \nYour NEXT_PUBLIC_SUPABASE_URL is set to: ".concat(s,'\n\nThis looks like a dashboard URL. It should be the API URL instead.\n\nCorrect format: https://[project-ref].supabase.co\nExample: https://ptasyynqqlvrbhqmtvhl.supabase.co\n\nTo fix:\n1. Go to Supabase Dashboard → Settings → API\n2. Copy the "Project URL" (not the dashboard URL)\n3. Update NEXT_PUBLIC_SUPABASE_URL in Vercel\n4. Redeploy your application');throw console.error(e),alert("Configuration Error: Supabase URL is incorrect. Check console for details."),Error(e)}let n=(0,a.createClient)(s,o)}},function(e){e.O(0,[997,479,542,115,364,744],function(){return e(e.s=4552)}),_N_E=e.O()}]);