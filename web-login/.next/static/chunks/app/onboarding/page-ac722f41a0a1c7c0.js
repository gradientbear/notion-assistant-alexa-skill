(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[461],{9632:function(e,t,n){Promise.resolve().then(n.bind(n,3077))},59:function(e,t,n){"use strict";n.d(t,{w_:function(){return l}});var o=n(8078),a={color:void 0,size:void 0,className:void 0,style:void 0,attr:void 0},r=o.createContext&&o.createContext(a),s=function(){return(s=Object.assign||function(e){for(var t,n=1,o=arguments.length;n<o;n++)for(var a in t=arguments[n])Object.prototype.hasOwnProperty.call(t,a)&&(e[a]=t[a]);return e}).apply(this,arguments)},i=function(e,t){var n={};for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&0>t.indexOf(o)&&(n[o]=e[o]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols)for(var a=0,o=Object.getOwnPropertySymbols(e);a<o.length;a++)0>t.indexOf(o[a])&&Object.prototype.propertyIsEnumerable.call(e,o[a])&&(n[o[a]]=e[o[a]]);return n};function l(e){return function(t){return o.createElement(c,s({attr:s({},e.attr)},t),function e(t){return t&&t.map(function(t,n){return o.createElement(t.tag,s({key:n},t.attr),e(t.child))})}(e.child))}}function c(e){var t=function(t){var n,a=e.attr,r=e.size,l=e.title,c=i(e,["attr","size","title"]),d=r||t.size||"1em";return t.className&&(n=t.className),e.className&&(n=(n?n+" ":"")+e.className),o.createElement("svg",s({stroke:"currentColor",fill:"currentColor",strokeWidth:"0"},t.attr,a,c,{className:n,style:s(s({color:e.color||t.color},t.style),e.style),height:d,width:d,xmlns:"http://www.w3.org/2000/svg"}),l&&o.createElement("title",null,l),e.children)};return void 0!==r?o.createElement(r.Consumer,null,function(e){return t(e)}):t(a)}},3077:function(e,t,n){"use strict";n.r(t),n.d(t,{default:function(){return l}});var o=n(7821),a=n(8078),r=n(8504),s=n(9905),i=n(8955);function l(){let e=(0,r.useRouter)(),[t,n]=(0,a.useState)(!0),[l,c]=(0,a.useState)(null),[d,u]=(0,a.useState)("notion"),[m,h]=(0,a.useState)(!1),[p,b]=(0,a.useState)(""),[x,g]=(0,a.useState)("");(0,a.useEffect)(()=>(f(),"true"===new URLSearchParams(window.location.search).get("notion_connected")&&(g("Notion connected successfully! Voice Planner page and databases created."),window.history.replaceState({},"","/onboarding")),()=>{}),[]);let f=async()=>{try{var t,o,a,r;let{data:{user:i}}=await s.O.auth.getUser();if(!i){e.push("/?mode=signin");return}let l=await s.O.auth.getSession(),d=null===(t=l.data.session)||void 0===t?void 0:t.access_token;if(!d){e.push("/?mode=signin");return}try{let e=await fetch("/api/auth/sync-user",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({auth_user_id:i.id,email:i.email||"",provider:(null===(o=i.app_metadata)||void 0===o?void 0:o.provider)||"email"})});e.ok||console.warn("Sync user response not OK:",e.status)}catch(e){console.warn("Sync attempt failed (may already exist):",e)}await new Promise(e=>setTimeout(e,500));let m=await fetch("/api/users/me",{method:"GET",headers:{Authorization:"Bearer ".concat(d),"Content-Type":"application/json"},cache:"no-store"});if(!m.ok){if(404===m.status){console.log("User not found, attempting final sync..."),await fetch("/api/auth/sync-user",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({auth_user_id:i.id,email:i.email||"",provider:(null===(a=i.app_metadata)||void 0===a?void 0:a.provider)||"email"})}),await new Promise(e=>setTimeout(e,1e3));let e=await fetch("/api/users/me",{method:"GET",headers:{Authorization:"Bearer ".concat(d),"Content-Type":"application/json"},cache:"no-store"});if(!e.ok){console.error("User still not found after sync. Status:",e.status),b("Unable to load user data. Please try refreshing the page."),n(!1);return}let t=await e.json();c(t),n(!1);return}console.error("Failed to fetch user:",m.status,m.statusText),b("Failed to load user: ".concat(m.status)),n(!1);return}let h=await m.json();if(c(h),h.onboarding_complete){e.push("/dashboard");return}if(h.notion_token){if(h.amazon_account_id){u("complete");try{let e=await s.O.auth.getSession(),t=null===(r=e.data.session)||void 0===r?void 0:r.access_token;t&&await fetch("/api/users/complete-onboarding",{method:"POST",headers:{Authorization:"Bearer ".concat(t),"Content-Type":"application/json"}})}catch(e){console.warn("Failed to auto-complete onboarding:",e)}}else u("amazon")}else u("notion");n(!1)}catch(e){console.error("Error checking user:",e),n(!1)}},y=async()=>{h(!0);try{let{data:{user:e}}=await s.O.auth.getUser();if(!e){b("Please sign in to connect Notion"),h(!1);return}let t=await fetch("/api/oauth/initiate",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({email:(null==l?void 0:l.email)||e.email,auth_user_id:e.id})});if(!t.ok){let e=await t.json();throw Error(e.error||"Failed to initiate Notion connection")}let{authUrl:n}=await t.json();window.location.href=n}catch(e){console.error("Error initiating Notion OAuth:",e),b(e.message||"Failed to connect Notion. Please try again."),h(!1)}},N=async()=>{h(!0),e.push("/amazon/link")},j=async()=>{(null==l?void 0:l.amazon_account_id)?u("complete"):u("amazon")},v=[{id:"notion",title:"Connect Notion (Optional)",description:"Link your Notion workspace and we'll automatically create the required databases. You can skip this and connect later.",completed:!!(null==l?void 0:l.notion_token)&&(null==l?void 0:l.notion_setup_complete),action:y,skippable:!0},{id:"amazon",title:"Link Amazon Account",description:"Connect your Amazon account to enable the Alexa skill",completed:!!(null==l?void 0:l.amazon_account_id),action:N}];return t?(0,o.jsx)("div",{className:"min-h-screen flex items-center justify-center bg-gradient-to-br from-blue-50 to-indigo-100",children:(0,o.jsxs)("div",{className:"text-gray-600",children:[(0,o.jsx)(i.fCD,{className:"animate-spin text-4xl mx-auto mb-4"}),(0,o.jsx)("p",{children:"Loading..."})]})}):(0,o.jsx)("div",{className:"min-h-screen bg-gradient-to-br from-blue-50 to-indigo-100 py-12 px-4",children:(0,o.jsx)("div",{className:"max-w-2xl mx-auto",children:(0,o.jsxs)("div",{className:"bg-white rounded-2xl shadow-xl p-8",children:[(0,o.jsx)("h1",{className:"text-3xl font-bold text-gray-900 mb-2",children:"Welcome to Voice Planner"}),(0,o.jsx)("p",{className:"text-gray-600 mb-8",children:"Complete these steps to get started"}),x&&(0,o.jsxs)("div",{className:"mb-6 p-4 bg-green-50 border border-green-200 text-green-700 rounded-lg",children:[(0,o.jsx)("p",{className:"font-medium mb-2",children:"Success!"}),(0,o.jsx)("p",{className:"text-sm",children:x})]}),p&&(0,o.jsxs)("div",{className:"mb-6 p-4 bg-red-50 border border-red-200 text-red-700 rounded-lg",children:[(0,o.jsx)("p",{className:"font-medium mb-2",children:"Error"}),(0,o.jsx)("p",{className:"text-sm mb-3",children:p}),(0,o.jsx)("button",{onClick:()=>{b(""),n(!0),f()},className:"px-4 py-2 bg-red-600 text-white rounded-lg hover:bg-red-700 text-sm",children:"Retry"})]}),(0,o.jsx)("div",{className:"space-y-6 mb-8",children:v.map((e,t)=>{let n=d===e.id,a=e.completed;return(0,o.jsx)("div",{className:"border-2 rounded-lg p-6 transition-all ".concat(n?"border-blue-500 bg-blue-50":a?"border-green-500 bg-green-50":"border-gray-200 bg-gray-50"),children:(0,o.jsxs)("div",{className:"flex items-start gap-4",children:[(0,o.jsx)("div",{className:"flex-shrink-0 mt-1",children:a?(0,o.jsx)(i.FJM,{className:"text-green-500 text-2xl"}):n?(0,o.jsx)(i.gbA,{className:"text-blue-500 text-2xl"}):(0,o.jsx)(i.gbA,{className:"text-gray-300 text-2xl"})}),(0,o.jsxs)("div",{className:"flex-1",children:[(0,o.jsxs)("h3",{className:"text-xl font-semibold text-gray-900 mb-1",children:[t+1,". ",e.title]}),(0,o.jsx)("p",{className:"text-gray-600 mb-4",children:e.description}),n&&!a&&(0,o.jsxs)("div",{className:"flex flex-col sm:flex-row gap-3",children:["notion"===e.id&&(0,o.jsxs)(o.Fragment,{children:[(0,o.jsx)("a",{href:"https://www.notion.so/signup",target:"_blank",rel:"noopener noreferrer",className:"px-6 py-2 bg-white border-2 border-blue-600 text-blue-600 font-semibold rounded-lg hover:bg-blue-50 transition text-center",children:"Create Notion Account"}),(0,o.jsx)("button",{onClick:e.action,disabled:m,className:"px-6 py-2 bg-gradient-to-r from-blue-600 to-indigo-600 text-white font-semibold rounded-lg hover:from-blue-700 hover:to-indigo-700 transition disabled:opacity-50",children:m?"Processing...":"Connect Notion"}),(0,o.jsx)("button",{onClick:j,disabled:m,className:"px-6 py-2 bg-gray-200 text-gray-700 font-semibold rounded-lg hover:bg-gray-300 transition disabled:opacity-50",children:"Skip for Now"})]}),"notion"!==e.id&&(0,o.jsx)("button",{onClick:e.action,disabled:m,className:"px-6 py-2 bg-gradient-to-r from-blue-600 to-indigo-600 text-white font-semibold rounded-lg hover:from-blue-700 hover:to-indigo-700 transition disabled:opacity-50",children:m?"Processing...":"Start ".concat(e.title)})]}),a&&(0,o.jsx)("span",{className:"inline-flex items-center px-3 py-1 bg-green-100 text-green-800 rounded-full text-sm font-medium",children:"Completed"})]})]})},e.id)})}),"notion"===d&&(0,o.jsxs)("div",{className:"space-y-4 mb-6",children:[(0,o.jsxs)("div",{className:"bg-blue-50 border border-blue-200 rounded-lg p-4",children:[(0,o.jsx)("p",{className:"text-sm text-blue-800 mb-2",children:(0,o.jsx)("strong",{children:"Don't have a Notion account?"})}),(0,o.jsx)("p",{className:"text-sm text-blue-700 mb-3",children:'Notion is free to use. Click "Create Notion Account" above to sign up, then come back to connect your workspace.'}),(0,o.jsx)("p",{className:"text-sm text-blue-700",children:"You can also skip this step and connect Notion later from your dashboard."})]}),(0,o.jsxs)("div",{className:"bg-green-50 border border-green-200 rounded-lg p-4",children:[(0,o.jsx)("p",{className:"text-sm text-green-800",children:(0,o.jsx)("strong",{children:"What we'll create in your Notion workspace:"})}),(0,o.jsxs)("ul",{className:"list-disc list-inside text-sm text-green-700 mt-2 space-y-1",children:[(0,o.jsx)("li",{children:'A "Voice Planner" page in your Notion workspace'}),(0,o.jsx)("li",{children:"Tasks database for task management"}),(0,o.jsx)("li",{children:"Focus_Logs database for focus tracking"}),(0,o.jsx)("li",{children:"Energy_Logs database for energy tracking"})]})]})]}),"amazon"===d&&(0,o.jsxs)("div",{className:"bg-blue-50 border border-blue-200 rounded-lg p-4 mb-6",children:[(0,o.jsx)("p",{className:"text-sm text-blue-800",children:(0,o.jsx)("strong",{children:"Why link your Amazon account?"})}),(0,o.jsxs)("ul",{className:"list-disc list-inside text-sm text-blue-700 mt-2 space-y-1",children:[(0,o.jsx)("li",{children:"Enables the Alexa skill to identify you"}),(0,o.jsx)("li",{children:"Required for using the skill on your Alexa devices"}),(0,o.jsx)("li",{children:"Links your web account to your Alexa account"})]})]})]})})})}},9905:function(e,t,n){"use strict";n.d(t,{O:function(){return s}});var o=n(2616);n(2949);let a="https://mwvurelnhrcbtpjtsiyb.supabase.co",r="eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Im13dnVyZWxuaHJjYnRwanRzaXliIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjQ2MTE2NjYsImV4cCI6MjA4MDE4NzY2Nn0.4kMmjVKg9V0qUhQQMzxu9CdJuQ-zWpItaaqT3QzAEII";if(!a||!r)throw console.error("❌ Missing Supabase configuration!"),console.error("Please set NEXT_PUBLIC_SUPABASE_URL and NEXT_PUBLIC_SUPABASE_ANON_KEY in your environment variables."),Error("Missing Supabase environment variables. Please set NEXT_PUBLIC_SUPABASE_URL and NEXT_PUBLIC_SUPABASE_ANON_KEY. For local development, create a .env.local file. For production (Vercel), add them in your project settings.");if(a.includes("supabase.com/dashboard")||a.includes("dashboard/project")){let e="❌ Invalid Supabase URL format!\n  \nYour NEXT_PUBLIC_SUPABASE_URL is set to: ".concat(a,'\n\nThis looks like a dashboard URL. It should be the API URL instead.\n\nCorrect format: https://[project-ref].supabase.co\nExample: https://ptasyynqqlvrbhqmtvhl.supabase.co\n\nTo fix:\n1. Go to Supabase Dashboard → Settings → API\n2. Copy the "Project URL" (not the dashboard URL)\n3. Update NEXT_PUBLIC_SUPABASE_URL in Vercel\n4. Redeploy your application');throw console.error(e),alert("Configuration Error: Supabase URL is incorrect. Check console for details."),Error(e)}let s=(0,o.createClient)(a,r)}},function(e){e.O(0,[997,479,115,364,744],function(){return e(e.s=9632)}),_N_E=e.O()}]);