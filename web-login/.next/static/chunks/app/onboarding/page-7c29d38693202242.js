(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[461],{9632:function(e,t,o){Promise.resolve().then(o.bind(o,3077))},59:function(e,t,o){"use strict";o.d(t,{w_:function(){return l}});var n=o(8078),a={color:void 0,size:void 0,className:void 0,style:void 0,attr:void 0},s=n.createContext&&n.createContext(a),r=function(){return(r=Object.assign||function(e){for(var t,o=1,n=arguments.length;o<n;o++)for(var a in t=arguments[o])Object.prototype.hasOwnProperty.call(t,a)&&(e[a]=t[a]);return e}).apply(this,arguments)},i=function(e,t){var o={};for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&0>t.indexOf(n)&&(o[n]=e[n]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols)for(var a=0,n=Object.getOwnPropertySymbols(e);a<n.length;a++)0>t.indexOf(n[a])&&Object.prototype.propertyIsEnumerable.call(e,n[a])&&(o[n[a]]=e[n[a]]);return o};function l(e){return function(t){return n.createElement(c,r({attr:r({},e.attr)},t),function e(t){return t&&t.map(function(t,o){return n.createElement(t.tag,r({key:o},t.attr),e(t.child))})}(e.child))}}function c(e){var t=function(t){var o,a=e.attr,s=e.size,l=e.title,c=i(e,["attr","size","title"]),d=s||t.size||"1em";return t.className&&(o=t.className),e.className&&(o=(o?o+" ":"")+e.className),n.createElement("svg",r({stroke:"currentColor",fill:"currentColor",strokeWidth:"0"},t.attr,a,c,{className:o,style:r(r({color:e.color||t.color},t.style),e.style),height:d,width:d,xmlns:"http://www.w3.org/2000/svg"}),l&&n.createElement("title",null,l),e.children)};return void 0!==s?n.createElement(s.Consumer,null,function(e){return t(e)}):t(a)}},3077:function(e,t,o){"use strict";o.r(t),o.d(t,{default:function(){return l}});var n=o(7821),a=o(8078),s=o(8504),r=o(9905),i=o(8955);function l(){let e=(0,s.useRouter)(),[t,o]=(0,a.useState)(!0),[l,c]=(0,a.useState)(null),[d,u]=(0,a.useState)("notion"),[m,h]=(0,a.useState)(!1),[p,b]=(0,a.useState)(""),[x,g]=(0,a.useState)("");(0,a.useEffect)(()=>(f(),"true"===new URLSearchParams(window.location.search).get("notion_connected")&&(g("Notion connected successfully! Notion Data page and databases created."),window.history.replaceState({},"","/onboarding")),()=>{}),[]);let f=async()=>{try{var t,n,a,s;let{data:{user:i}}=await r.O.auth.getUser();if(!i){e.push("/?mode=signin");return}let l=await r.O.auth.getSession(),d=null===(t=l.data.session)||void 0===t?void 0:t.access_token;if(!d){e.push("/?mode=signin");return}try{let e=await fetch("/api/auth/sync-user",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({auth_user_id:i.id,email:i.email||"",provider:(null===(n=i.app_metadata)||void 0===n?void 0:n.provider)||"email"})});e.ok||console.warn("Sync user response not OK:",e.status)}catch(e){console.warn("Sync attempt failed (may already exist):",e)}await new Promise(e=>setTimeout(e,500));let m=await fetch("/api/users/me",{method:"GET",headers:{Authorization:"Bearer ".concat(d),"Content-Type":"application/json"},cache:"no-store"});if(!m.ok){if(404===m.status){console.log("User not found, attempting final sync..."),await fetch("/api/auth/sync-user",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({auth_user_id:i.id,email:i.email||"",provider:(null===(a=i.app_metadata)||void 0===a?void 0:a.provider)||"email"})}),await new Promise(e=>setTimeout(e,1e3));let e=await fetch("/api/users/me",{method:"GET",headers:{Authorization:"Bearer ".concat(d),"Content-Type":"application/json"},cache:"no-store"});if(!e.ok){console.error("User still not found after sync. Status:",e.status),b("Unable to load user data. Please try refreshing the page."),o(!1);return}let t=await e.json();c(t),o(!1);return}console.error("Failed to fetch user:",m.status,m.statusText),b("Failed to load user: ".concat(m.status)),o(!1);return}let h=await m.json();if(c(h),h.onboarding_complete){e.push("/dashboard");return}if(h.notion_token){if(h.amazon_account_id){u("complete");try{let e=await r.O.auth.getSession(),t=null===(s=e.data.session)||void 0===s?void 0:s.access_token;t&&await fetch("/api/users/complete-onboarding",{method:"POST",headers:{Authorization:"Bearer ".concat(t),"Content-Type":"application/json"}})}catch(e){console.warn("Failed to auto-complete onboarding:",e)}}else u("amazon")}else u("notion");o(!1)}catch(e){console.error("Error checking user:",e),o(!1)}},y=async()=>{h(!0);try{let{data:{user:e}}=await r.O.auth.getUser();if(!e){b("Please sign in to connect Notion"),h(!1);return}let t=await fetch("/api/oauth/initiate",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({email:(null==l?void 0:l.email)||e.email,auth_user_id:e.id})});if(!t.ok){let e=await t.json();throw Error(e.error||"Failed to initiate Notion connection")}let{authUrl:o}=await t.json();window.location.href=o}catch(e){console.error("Error initiating Notion OAuth:",e),b(e.message||"Failed to connect Notion. Please try again."),h(!1)}},N=async()=>{h(!0),e.push("/amazon/link")},j=async()=>{(null==l?void 0:l.amazon_account_id)?u("complete"):u("amazon")},v=[{id:"notion",title:"Connect Notion (Optional)",description:"Link your Notion workspace and we'll automatically create the required databases. You can skip this and connect later.",completed:!!(null==l?void 0:l.notion_token)&&(null==l?void 0:l.notion_setup_complete),action:y,skippable:!0},{id:"amazon",title:"Link Amazon Account",description:"Connect your Amazon account to enable the Alexa skill",completed:!!(null==l?void 0:l.amazon_account_id),action:N}];return t?(0,n.jsx)("div",{className:"min-h-screen flex items-center justify-center bg-gradient-to-br from-blue-50 to-indigo-100",children:(0,n.jsxs)("div",{className:"text-gray-600",children:[(0,n.jsx)(i.fCD,{className:"animate-spin text-4xl mx-auto mb-4"}),(0,n.jsx)("p",{children:"Loading..."})]})}):(0,n.jsx)("div",{className:"min-h-screen bg-gradient-to-br from-blue-50 to-indigo-100 py-12 px-4",children:(0,n.jsx)("div",{className:"max-w-2xl mx-auto",children:(0,n.jsxs)("div",{className:"bg-white rounded-2xl shadow-xl p-8",children:[(0,n.jsx)("h1",{className:"text-3xl font-bold text-gray-900 mb-2",children:"Welcome to Notion Data"}),(0,n.jsx)("p",{className:"text-gray-600 mb-8",children:"Complete these steps to get started"}),x&&(0,n.jsxs)("div",{className:"mb-6 p-4 bg-green-50 border border-green-200 text-green-700 rounded-lg",children:[(0,n.jsx)("p",{className:"font-medium mb-2",children:"Success!"}),(0,n.jsx)("p",{className:"text-sm",children:x})]}),p&&(0,n.jsxs)("div",{className:"mb-6 p-4 bg-red-50 border border-red-200 text-red-700 rounded-lg",children:[(0,n.jsx)("p",{className:"font-medium mb-2",children:"Error"}),(0,n.jsx)("p",{className:"text-sm mb-3",children:p}),(0,n.jsx)("button",{onClick:()=>{b(""),o(!0),f()},className:"px-4 py-2 bg-red-600 text-white rounded-lg hover:bg-red-700 text-sm",children:"Retry"})]}),(0,n.jsx)("div",{className:"space-y-6 mb-8",children:v.map((e,t)=>{let o=d===e.id,a=e.completed;return(0,n.jsx)("div",{className:"border-2 rounded-lg p-6 transition-all ".concat(o?"border-blue-500 bg-blue-50":a?"border-green-500 bg-green-50":"border-gray-200 bg-gray-50"),children:(0,n.jsxs)("div",{className:"flex items-start gap-4",children:[(0,n.jsx)("div",{className:"flex-shrink-0 mt-1",children:a?(0,n.jsx)(i.FJM,{className:"text-green-500 text-2xl"}):o?(0,n.jsx)(i.gbA,{className:"text-blue-500 text-2xl"}):(0,n.jsx)(i.gbA,{className:"text-gray-300 text-2xl"})}),(0,n.jsxs)("div",{className:"flex-1",children:[(0,n.jsxs)("h3",{className:"text-xl font-semibold text-gray-900 mb-1",children:[t+1,". ",e.title]}),(0,n.jsx)("p",{className:"text-gray-600 mb-4",children:e.description}),o&&!a&&(0,n.jsxs)("div",{className:"flex flex-col sm:flex-row gap-3",children:["notion"===e.id&&(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)("a",{href:"https://www.notion.so/signup",target:"_blank",rel:"noopener noreferrer",className:"px-6 py-2 bg-white border-2 border-blue-600 text-blue-600 font-semibold rounded-lg hover:bg-blue-50 transition text-center",children:"Create Notion Account"}),(0,n.jsx)("button",{onClick:e.action,disabled:m,className:"px-6 py-2 bg-gradient-to-r from-blue-600 to-indigo-600 text-white font-semibold rounded-lg hover:from-blue-700 hover:to-indigo-700 transition disabled:opacity-50",children:m?"Processing...":"Connect Notion"}),(0,n.jsx)("button",{onClick:j,disabled:m,className:"px-6 py-2 bg-gray-200 text-gray-700 font-semibold rounded-lg hover:bg-gray-300 transition disabled:opacity-50",children:"Skip for Now"})]}),"notion"!==e.id&&(0,n.jsx)("button",{onClick:e.action,disabled:m,className:"px-6 py-2 bg-gradient-to-r from-blue-600 to-indigo-600 text-white font-semibold rounded-lg hover:from-blue-700 hover:to-indigo-700 transition disabled:opacity-50",children:m?"Processing...":"Start ".concat(e.title)})]}),a&&(0,n.jsx)("span",{className:"inline-flex items-center px-3 py-1 bg-green-100 text-green-800 rounded-full text-sm font-medium",children:"Completed"})]})]})},e.id)})}),"notion"===d&&(0,n.jsxs)("div",{className:"space-y-4 mb-6",children:[(0,n.jsxs)("div",{className:"bg-blue-50 border border-blue-200 rounded-lg p-4",children:[(0,n.jsx)("p",{className:"text-sm text-blue-800 mb-2",children:(0,n.jsx)("strong",{children:"Don't have a Notion account?"})}),(0,n.jsx)("p",{className:"text-sm text-blue-700 mb-3",children:'Notion is free to use. Click "Create Notion Account" above to sign up, then come back to connect your workspace.'}),(0,n.jsx)("p",{className:"text-sm text-blue-700",children:"You can also skip this step and connect Notion later from your dashboard."})]}),(0,n.jsxs)("div",{className:"bg-green-50 border border-green-200 rounded-lg p-4",children:[(0,n.jsx)("p",{className:"text-sm text-green-800",children:(0,n.jsx)("strong",{children:"What we'll create in your Notion workspace:"})}),(0,n.jsxs)("ul",{className:"list-disc list-inside text-sm text-green-700 mt-2 space-y-1",children:[(0,n.jsx)("li",{children:'A "Notion Data" page in your Notion workspace'}),(0,n.jsx)("li",{children:"Tasks database for task management"}),(0,n.jsx)("li",{children:"Focus_Logs database for focus tracking"}),(0,n.jsx)("li",{children:"Energy_Logs database for energy tracking"})]})]})]}),"amazon"===d&&(0,n.jsxs)("div",{className:"bg-blue-50 border border-blue-200 rounded-lg p-4 mb-6",children:[(0,n.jsx)("p",{className:"text-sm text-blue-800",children:(0,n.jsx)("strong",{children:"Why link your Amazon account?"})}),(0,n.jsxs)("ul",{className:"list-disc list-inside text-sm text-blue-700 mt-2 space-y-1",children:[(0,n.jsx)("li",{children:"Enables the Alexa skill to identify you"}),(0,n.jsx)("li",{children:"Required for using the skill on your Alexa devices"}),(0,n.jsx)("li",{children:"Links your web account to your Alexa account"})]})]})]})})})}},9905:function(e,t,o){"use strict";o.d(t,{O:function(){return r}});var n=o(2616);o(2949);let a="https://ptasyynqqlvrbhqmtvhl.supabase.co",s="eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InB0YXN5eW5xcWx2cmJocW10dmhsIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjM4NzYwODYsImV4cCI6MjA3OTQ1MjA4Nn0.di3Mk3cndlDzjWwUoXcB8DDslyJO-lbsIHtwRKaWCZI";if(!a||!s)throw console.error("❌ Missing Supabase configuration!"),console.error("Please set NEXT_PUBLIC_SUPABASE_URL and NEXT_PUBLIC_SUPABASE_ANON_KEY in your environment variables."),Error("Missing Supabase environment variables. Please set NEXT_PUBLIC_SUPABASE_URL and NEXT_PUBLIC_SUPABASE_ANON_KEY. For local development, create a .env.local file. For production (Vercel), add them in your project settings.");if(a.includes("supabase.com/dashboard")||a.includes("dashboard/project")){let e="❌ Invalid Supabase URL format!\n  \nYour NEXT_PUBLIC_SUPABASE_URL is set to: ".concat(a,'\n\nThis looks like a dashboard URL. It should be the API URL instead.\n\nCorrect format: https://[project-ref].supabase.co\nExample: https://ptasyynqqlvrbhqmtvhl.supabase.co\n\nTo fix:\n1. Go to Supabase Dashboard → Settings → API\n2. Copy the "Project URL" (not the dashboard URL)\n3. Update NEXT_PUBLIC_SUPABASE_URL in Vercel\n4. Redeploy your application');throw console.error(e),alert("Configuration Error: Supabase URL is incorrect. Check console for details."),Error(e)}let r=(0,n.createClient)(a,s)}},function(e){e.O(0,[997,479,115,364,744],function(){return e(e.s=9632)}),_N_E=e.O()}]);